// scripts/generate.js

import fs from 'fs/promises'
import fetch from 'node-fetch'
import { parse } from 'csv-parse/sync'

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1. Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ CSV ã‚’å–å¾—ã™ã‚‹ãŸã‚ã® URL ã‚’è¨­å®š
//    ï¼ˆé©å®œã€ã”è‡ªèº«ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€ŒCSV å‡ºåŠ›ã€URL ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CSV_URL =
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vTi95JqDq1YqLvhInMToDFlMRYKx0mZUv7ZPFWWHG3e-Ncw4O3cxptIS8rfDMyfq_z0WDrpYU4q5ZyL/pub?output=csv'

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 2. ç”Ÿæˆã•ã‚Œã‚‹ HTML ã®ãƒ™ãƒ¼ã‚¹ URL ã‚’è¨­å®šï¼ˆã”è‡ªèº«ã® Cloudflare Pages ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const BASE_URL = 'https://job-site-6aa.pages.dev'

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// main(): CSV ã‚’èª­ã¿è¾¼ã¿ã€HTML ã¨ sitemap.xml ã‚’å‡ºåŠ›ã™ã‚‹
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function main() {
  try {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 1) Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ CSV ã‚’ fetch ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const res = await fetch(CSV_URL)
    if (!res.ok) {
      throw new Error(`CSV ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ${res.status} ${res.statusText}`)
    }
    const csvText = await res.text()

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 2) csv-parse ã§ã€Œãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚ã‚Šãƒ»ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—ã€ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦
    //    JavaScript ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã«å¤‰æ›ã™ã‚‹
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const records = parse(csvText, {
      columns: true,       // 1 è¡Œç›®ã‚’ã‚­ãƒ¼ã¨ã—ã¦ä½¿ã†
      skip_empty_lines: true
    })
    // records ã¯ãŸã¨ãˆã°ã“ã‚“ãªå½¢ã®é…åˆ—ã«ãªã‚Šã¾ã™:
    // [
    //   {
    //     id: '1',
    //     'è·ç¨®å': 'æ³•äººå–¶æ¥­',
    //     'æ±‚äººã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼': 'ãƒªãƒ¼ãƒ€ãƒ¼å€™è£œï¼šãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼...',
    //     'ä¼šç¤¾å': 'æ ªå¼ä¼šç¤¾ã‚¸ãƒ§ãƒªãƒ¼ã‚°ãƒƒãƒ‰',
    //     'å‹¤å‹™åœ°': 'æ±äº¬éƒ½ä¸­å¤®åŒºæ—¥æœ¬æ©‹å¯Œæ²¢ç”º10-13 WORK EDITION NIHONBASHI 701',
    //     'éƒ½é“åºœçœŒ': 'æ±äº¬éƒ½',
    //     'å¸‚åŒºç”ºæ‘': 'ä¸­å¤®åŒº',
    //     'éƒµä¾¿ç•ªå·': '1030006',
    //     'é›‡ç”¨å½¢æ…‹': 'æ­£ç¤¾å“¡',
    //     'ä»•äº‹å†…å®¹ï¼ˆä»•äº‹å†…å®¹ï¼‰': 'è‡ªç¤¾VRã®æŠ€è¡“ã‚’æ´»ã‹ã—ã€ã€œâ€¦',
    //     'ä»•äº‹å†…å®¹ï¼ˆå‹¤å‹™æ™‚é–“ãƒ»æ›œæ—¥ï¼‰': '10:00ã€œ19:00\næ‰€å®šåŠ´åƒæ™‚é–“ï¼š8æ™‚é–“ã€ä¼‘æ†©1æ™‚é–“',
    //     'ä¼‘æš‡ãƒ»ä¼‘æ—¥': 'å®Œå…¨é€±ä¼‘2æ—¥åˆ¶ï¼ˆåœŸæ—¥ç¥æ—¥ä¼‘ã¿ï¼‰\nå¹´é–“ä¼‘æ—¥125æ—¥ä»¥ä¸Š\nâ€¦',
    //     'å—å‹•å–«ç…™å¯¾ç­–': 'å—å‹•å–«ç…™å¯¾ç­–ï¼š å–«ç…™ã‚¹ãƒšãƒ¼ã‚¹ã‚ã‚Š\nå—å‹•å–«ç…™å¯¾ç­–ï¼ˆè©³ç´°ï¼‰ï¼š å±‹å†…å…¨é¢ç¦ç…™',
    //     'å¾…é‡ãƒ»ç¦åˆ©åšç”Ÿ': 'â– æ™‚å·®å‡ºå‹¤ï¼ˆ9æ™‚ã€œ11æ™‚å‡ºç¤¾ï¼‰å¯èƒ½\nâ– å„ç¨®ç¤¾ä¼šä¿é™ºå®Œå‚™\nâ€¦',
    //     'çµ¦ä¸ï¼ˆä¸‹é™ï¼‰': '5500000',
    //     'çµ¦ä¸ä¸Šé™': '7000000',
    //     'çµ¦ä¸ç¨®åˆ¥': 'å¹´å',
    //     'è·ç¨®ã‚«ãƒ†ã‚´ãƒªãƒ¼': 'å–¶æ¥­',
    //     'æ²è¼‰ç”»åƒ': '',
    //     'å¿œå‹Ÿ': ''
    //   },
    //   { ... },
    //   â€¦
    // ]

    console.log(`â€•â€•â€•â€•â€•â€• records ã®æœ€åˆã® 3 ä»¶: â€•â€•â€•â€•â€•â€•`)
    console.log(records.slice(0, 3))
    console.log(`â€•â€•â€•â€•â€•â€• å…¨ä»¶æ•°: ${records.length} â€•â€•â€•â€•â€•â€•\n`)

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 3) dist ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆï¼ˆãªã‘ã‚Œã°ï¼‰ã€‚å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ HTML ã«å¤‰æ›ã—ã¦æ›¸ãå‡ºã—
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    await fs.mkdir('dist', { recursive: true })

    for (const [idx, job] of records.entries()) {
      // generate individual job HTML
      const html = buildJobHtml(job, idx + 1)
      const filename = `dist/job-${idx + 1}.html`
      await fs.writeFile(filename, html, 'utf8')
      console.log(`âœ“ ${filename} ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`)
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4) sitemap.xml ã‚’ç”Ÿæˆã—ã¦æ›¸ãå‡ºã—
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const sitemapXml = buildSitemapXml(records.length)
    await fs.writeFile('dist/sitemap.xml', sitemapXml, 'utf8')
    console.log(`âœ“ dist/sitemap.xml ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`)

  } catch (err) {
    console.error('âœ— ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', err)
    process.exit(1)
  }
}

/**
 * buildJobHtml:
 *  å„æ±‚äººãƒ¬ã‚³ãƒ¼ãƒ‰(job ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã‚’å—ã‘å–ã‚Šã€æ–‡å­—åˆ—ã¨ã—ã¦ã® HTML ã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚
 * ä¾‹ï¼š
 *    job = {
 *      id: '1',
 *      'è·ç¨®å': 'æ³•äººå–¶æ¥­',
 *      'æ±‚äººã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼': 'ãƒªãƒ¼ãƒ€ãƒ¼å€™è£œï¼šãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼',
 *      'ä¼šç¤¾å': 'æ ªå¼ä¼šç¤¾ã‚¸ãƒ§ãƒªãƒ¼ã‚°ãƒƒãƒ‰',
 *      'å‹¤å‹™åœ°': 'æ±äº¬éƒ½ä¸­å¤®åŒºæ—¥æœ¬æ©‹å¯Œæ²¢ç”º10-13 WORK EDITION NIHONBASHI 701',
 *      'é›‡ç”¨å½¢æ…‹': 'æ­£ç¤¾å“¡',
 *      'ä»•äº‹å†…å®¹ï¼ˆä»•äº‹å†…å®¹ï¼‰': 'è‡ªç¤¾VRã®æŠ€è¡“ã‚’æ´»ã‹ã—ã€â€¦',
 *      'ä»•äº‹å†…å®¹ï¼ˆå‹¤å‹™æ™‚é–“ãƒ»æ›œæ—¥ï¼‰': '10:00ã€œ19:00â€¦',
 *      'ä¼‘æš‡ãƒ»ä¼‘æ—¥': 'å®Œå…¨é€±ä¼‘2æ—¥åˆ¶â€¦',
 *      'å—å‹•å–«ç…™å¯¾ç­–': 'å—å‹•å–«ç…™å¯¾ç­–ï¼šâ€¦',
 *      'å¾…é‡ãƒ»ç¦åˆ©åšç”Ÿ': 'â– æ™‚å·®å‡ºå‹¤â€¦',
 *      'çµ¦ä¸ï¼ˆä¸‹é™ï¼‰': '5500000',
 *      'çµ¦ä¸ä¸Šé™': '7000000',
 *      'çµ¦ä¸ç¨®åˆ¥': 'å¹´å',
 *      'è·ç¨®ã‚«ãƒ†ã‚´ãƒªãƒ¼': 'å–¶æ¥­',
 *      'æ²è¼‰ç”»åƒ': '',
 *      'å¿œå‹Ÿ': ''
 *    }
 *
 *  ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‚è€ƒã«ã€å®Ÿéš›ã®è¦‹ãŸç›®ï¼ˆCSS ãªã©ï¼‰ã¯ã™ã§ã«å®Œæˆã—ã¦ã„ãŸ
 *  job-1.html ã®æ§‹é€ ã‚’ã»ã¼ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã¾ã™ã€‚ã”è‡ªèº«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„ã€‚
 */
function buildJobHtml(job, idx) {
  // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®‰å…¨ã«å–ã‚Šå‡ºã™ã€‚å­˜åœ¨ã—ãªã„å ´åˆã¯ç©ºæ–‡å­—ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  const title = job['è·ç¨®å'] || 'ã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š'
  const subtitle = job['æ±‚äººã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼'] || ''
  const company = job['ä¼šç¤¾å'] || ''
  const location = job['å‹¤å‹™åœ°'] || ''
  const employmentType = job['é›‡ç”¨å½¢æ…‹'] || ''
  const description = job['ä»•äº‹å†…å®¹ï¼ˆä»•äº‹å†…å®¹ï¼‰'] || ''
  const workHours = job['ä»•äº‹å†…å®¹ï¼ˆå‹¤å‹™æ™‚é–“ãƒ»æ›œæ—¥ï¼‰'] || ''
  const holidays = job['ä¼‘æš‡ãƒ»ä¼‘æ—¥'] || ''
  const smoking = job['å—å‹•å–«ç…™å¯¾ç­–'] || ''
  const benefits = job['å¾…é‡ãƒ»ç¦åˆ©åšç”Ÿ'] || ''
  const salaryMin = job['çµ¦ä¸ï¼ˆä¸‹é™ï¼‰'] || ''
  const salaryMax = job['çµ¦ä¸ä¸Šé™'] || ''
  const salaryUnit = job['çµ¦ä¸ç¨®åˆ¥'] || ''
  const category = job['è·ç¨®ã‚«ãƒ†ã‚´ãƒªãƒ¼'] || ''

  // JSON-LD ç”¨ã®æ—¥ä»˜ï¼ˆæœ¬æ—¥æ™‚ç‚¹ï¼‰ï¼šãŸã¨ãˆã°ã€Œ2025-06-01ã€å½¢å¼ã«ã—ã¾ã™
  const today = new Date().toISOString().slice(0, 10)
  // æ±‚äººæœ‰åŠ¹æœŸé™ï¼ˆé©å®œè¨­å®šã€‚ã“ã“ã§ã¯é€šçŸ¥ã®ãŸã‚ã€Œ1 ãƒ¶æœˆå¾Œã€ã«ã—ã¦ã„ã¾ã™ï¼‰
  const validThrough = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30)
    .toISOString()
    .replace(/\..+$/, '')

  // HTML æœ¬ä½“ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦è¿”ã™
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <!-- Google ã‚µã‚¤ãƒˆèªè¨¼ã‚¿ã‚°ç­‰ãŒã‚ã‚Œã°ã“ã“ã«è¿½åŠ  -->
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>${title}</title>
  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä»¥ä¸‹ã¯ job-1.html ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã»ã¼ã‚³ãƒ”ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body {
      font-family: "Noto Sans JP", sans-serif;
      background: #f2f5f8;
      margin: 0;
      padding: 0;
    }
    header {
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .banner__inner {
      max-width: 720px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      padding: 1em;
    }
    .banner__icon {
      width: 48px;
      height: 48px;
      margin-right: 1em;
      color: #0073aa;
      flex-shrink: 0;
    }
    .banner__text h1 {
      margin: 0;
      font-size: 1.5em;
      color: #0073aa;
    }
    .banner__text .tagline {
      margin: 0.2em 0 0;
      font-size: 0.95em;
      color: #0073aa;
    }
    @media (max-width: 600px) {
      .banner__inner {
        flex-direction: column;
        text-align: center;
      }
      .banner__icon {
        margin: 0 0 0.5em;
      }
      .banner__text h1 {
        font-size: 1.2em;
      }
      .banner__text .tagline {
        font-size: 0.85em;
      }
    }
    .container {
      max-width: 720px;
      margin: 1.5em auto;
      padding: 0 1em;
    }
    section.job-detail {
      background: #ffffff;
      padding: 1.5em;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    section.job-detail h1 {
      margin-top: 0;
      font-size: 1.4em;
      color: #0073aa;
    }
    section.job-detail p {
      margin: 0.6em 0;
      color: #555;
      line-height: 1.6;
    }
    section.job-detail h3 {
      margin: 1em 0 0.5em;
      color: #333;
    }
    .form-button {
      display: inline-block;
      margin-top: 1em;
      background: #0073aa;
      color: #fff;
      padding: 0.6em 1.2em;
      border-radius: 4px;
      text-decoration: none;
      font-weight: bold;
    }
    .form-button:hover {
      background: #005f8d;
    }
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  </style>

  <!-- JSON-LD ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ -->
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "JobPosting",
  "title": "${title}",
  "description": "${escapeJsonLd(description).replace(/\n/g, ' ')}",
  "datePosted": "${today}",
  "validThrough": "${validThrough}",
  "employmentType": "${employmentType}",
  "hiringOrganization": {
    "@type": "Organization",
    "name": "${company}"
  },
  "jobLocation": {
    "@type": "Place",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "${location}",
      "addressLocality": "${job['å¸‚åŒºç”ºæ‘'] || ''}",
      "addressRegion": "${job['éƒ½é“åºœçœŒ'] || ''}",
      "postalCode": "${job['éƒµä¾¿ç•ªå·'] || ''}",
      "addressCountry": "JP"
    }
  },
  "baseSalary": {
    "@type": "MonetaryAmount",
    "currency": "JPY",
    "value": {
      "@type": "QuantitativeValue",
      "minValue": ${Number(salaryMin) || 0},
      "maxValue": ${Number(salaryMax) || 0},
      "unitText": "${salaryUnit}"
    }
  },
  "workHours": "${escapeJsonLd(workHours)}",
  "jobBenefits": [
    ${benefits.split('\n').map((line) => `"${escapeJsonLd(line)}"`).join(', ')}
  ],
  "occupationalCategory": "${category}"
}
  </script>
</head>
<body>
  <header>
    <div class="banner__inner">
      <!-- banner ã‚¢ã‚¤ã‚³ãƒ³ã¯ç›¸å¯¾ãƒ‘ã‚¹ã§èª­ã¿è¾¼ã¿ -->
      <img
        class="banner__icon"
        src="../assets/handshake-icon.svg"
        alt="æ¡æ‰‹ãƒãƒ¼ã‚¯ ãƒ­ã‚´"
      />
      <div class="banner__text">
        <h1>æ—¥æœ¬è»¢è·ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼</h1>
        <p class="tagline">ã‚ãªãŸã®æ–°ã—ã„ã‚­ãƒ£ãƒªã‚¢ã‚’ã€ç§ãŸã¡ãŒå…¨åŠ›ã‚µãƒãƒ¼ãƒˆã—ã¾ã™</p>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="job-detail">
      <h1>${title}</h1>
      ${subtitle ? `<p><em>${subtitle}</em></p>` : ''}
      ${company ? `<p><strong>ä¼šç¤¾åï¼š</strong>${company}</p>` : ''}
      ${location ? `<p><strong>å‹¤å‹™åœ°ï¼š</strong>${location}</p>` : ''}
      ${employmentType ? `<p><strong>é›‡ç”¨å½¢æ…‹ï¼š</strong>${employmentType}</p>` : ''}
      ${salaryMin || salaryMax
        ? `<p><strong>çµ¦ä¸ï¼š</strong>${salaryUnit} ${salaryMin || ''}${salaryMin && salaryMax ? 'ã€œ' : ''}${salaryMax || ''}</p>`
        : ''}
      ${description
        ? `<h3>ä»•äº‹å†…å®¹ï¼š</h3><p>${description.replace(/\n/g, '<br>')}</p>`
        : ''}
      ${workHours
        ? `<h3>å‹¤å‹™æ™‚é–“ï¼š</h3><p>${workHours.replace(/\n/g, '<br>')}</p>`
        : ''}
      ${holidays
        ? `<h3>ä¼‘æš‡ãƒ»ä¼‘æ—¥ï¼š</h3><p>${holidays.replace(/\n/g, '<br>')}</p>`
        : ''}
      ${smoking
        ? `<h3>å—å‹•å–«ç…™å¯¾ç­–ï¼š</h3><p>${smoking.replace(/\n/g, '<br>')}</p>`
        : ''}
      ${benefits
        ? `<h3>ç¦åˆ©åšç”Ÿï¼š</h3>
        <ul>
          ${benefits
            .split('\n')
            .map((line) => `<li>${line}</li>`)
            .join('')}
        </ul>`
        : ''}
      <!-- â†“ å¿œå‹Ÿãƒªãƒ³ã‚¯ãŒã‚ã‚‹å ´åˆã«ã¯ href ã‚’é©å®œæ›¸ãæ›ãˆã¦ãã ã•ã„ -->
      <p>
        <a
          class="form-button"
          href="${job['å¿œå‹Ÿ'] || '#'}"
          target="_blank"
          rel="noopener noreferrer"
        >
          ğŸ“ ã“ã®æ±‚äººã«å¿œå‹Ÿã™ã‚‹
        </a>
      </p>
    </section>
  </div>
</body>
</html>`
}

/**
 * buildSitemapXml:
 *  é©å®œã€Œdist/job-1.htmlã€ã€œã€Œdist/job-N.htmlã€ã‚’ã™ã¹ã¦åˆ—æŒ™ã—ã¦
 *  <urlset> ã®ä¸­ã« <url> ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
 *  recordsLength ã«ã¯ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ï¼ˆN ä»¶ï¼‰ã‚’æ¸¡ã—ã€1ã€œN ã®ãƒ«ãƒ¼ãƒ—ã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚
 */
function buildSitemapXml(recordsLength) {
  // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ YYYY-MM-DD å½¢å¼ã§å–å¾—ã—ã¦ lastmod ã«ä½¿ç”¨ã—ã¾ã™
  const today = new Date().toISOString().slice(0, 10)

  // sitemap ã®ãƒ˜ãƒƒãƒ€ãƒ¼
  let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`
  xml += `<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n`

  for (let i = 1; i <= recordsLength; i++) {
    xml += `  <url>\n`
    xml += `    <loc>${BASE_URL}/job-${i}.html</loc>\n`
    xml += `    <lastmod>${today}</lastmod>\n`
    xml += `    <changefreq>daily</changefreq>\n`
    xml += `    <priority>0.9</priority>\n`
    xml += `  </url>\n`
  }

  xml += `</urlset>\n`
  return xml
}

/**
 * escapeJsonLd:
 *  JSON-LD å†…ã«ãã®ã¾ã¾åŸ‹ã‚è¾¼ã‚€æ–‡å­—åˆ—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¾ã™ã€‚
 *  ä¾‹ï¼šæ”¹è¡Œã‚„ãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆã‚’é¿ã‘ã‚‹ãŸã‚ã®å˜ç´”ç½®ãæ›ãˆãƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚
 */
function escapeJsonLd(str) {
  return String(str || '')
    .replace(/\\/g, '\\\\')
    .replace(/"/g, '\\"')
    .replace(/\r?\n/g, '\\n')
}

// ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
main().catch((e) => {
  console.error(e)
  process.exit(1)
})
